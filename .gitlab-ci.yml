stages:
  - lint
  - test
  - build

image: python:3.10-slim

before_script:
  - python3 -m pip install \
      flake8 \
      build \
      twine \
      pytest

flake8:
  stage: lint
  script:
    - find . -name "*.py" -exec flake8 {} +
  allow_failure: true

test:
  stage: test
  script:
    - python3 -m pip install -r requirements.txt
    - python3 -m pytest

build:
  stage: build
  script:
    - python3 -m build
    - python3 -m twine upload --repository-url ${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/pypi dist/*
